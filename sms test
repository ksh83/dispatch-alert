# ğŸ”§ ì§„ë‹¨ ë„êµ¬ (app = get_app_state() í˜¸ì¶œ ì´í›„ì— ë°°ì¹˜)
with st.expander("ğŸ”§ ì§„ë‹¨ ë„êµ¬", expanded=False):
    # í¼ìœ¼ë¡œ ê°ì‹¸ë©´ Streamlitì˜ rerun/ë²„íŠ¼ ìƒíƒœ ê´€ë¦¬ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤.
    with st.form(key="solapi_test_form"):
        test_phone = st.text_input(
            "í…ŒìŠ¤íŠ¸ ìˆ˜ì‹ ë²ˆí˜¸(ìˆ«ìë§Œ, 10~11ìë¦¬)",
            key="test_phone_input",
            placeholder="01012345678",
        )
        submitted = st.form_submit_button("ğŸ“¨ Solapi í…ŒìŠ¤íŠ¸ ë°œì†¡", use_container_width=True)

    if submitted:
        # valid_phone ì´ ì—†ë‹¤ê³  ë‚˜ì˜¤ë©´ ì•„ë˜ ê°„ë‹¨ê²€ì¦ í•¨ìˆ˜ë¥¼ í•¨ê»˜ ì¶”ê°€í•˜ì„¸ìš”.
        if not valid_phone(test_phone):
            st.error("ì „í™”ë²ˆí˜¸ í˜•ì‹ ì˜¤ë¥˜ (ìˆ«ìë§Œ, 10~11ìë¦¬)")
        else:
            try:
                ok = app.sms.send(test_phone, "[í…ŒìŠ¤íŠ¸] ì¶œë™ì•Œë¦¼ ì‹œìŠ¤í…œ ì—°ê²° í™•ì¸")
                if ok:
                    st.success("Solapi í˜¸ì¶œ ì„±ê³µ (ìˆ˜ì‹ ì—¬ë¶€ëŠ” í†µì‹ ì‚¬/ìˆ˜ì‹ ë‹¨ ë¸”ë¡ì— ë”°ë¼ ì§€ì—°ë  ìˆ˜ ìˆìŒ)")
                else:
                    st.error("Solapi í˜¸ì¶œ ì‹¤íŒ¨ (ì½˜ì†”/í„°ë¯¸ë„ ë¡œê·¸ ë° .env ì„¤ì • í™•ì¸)")
            except Exception as e:
                st.exception(e)
